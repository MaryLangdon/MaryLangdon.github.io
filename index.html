<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ´›çªå¸Œçš„æŸ³å·å¤©æ°”é¢„æŠ¥</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Load Inter font -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');
        
        /* Base styling for smooth transitions */
        body {
            font-family: 'Inter', sans-serif;
            transition: background-color 0.5s, color 0.5s;
        }

        /* Custom Gradient for Roxy Header (Light Mode) */
        .roxy-gradient {
            background-image: linear-gradient(135deg, #7c3aed 0%, #a78bfa 100%); /* Purple/Lavender */
            box-shadow: 0 10px 30px rgba(124, 58, 237, 0.5);
        }

        /* Dark Mode Styling Overrides (Applied when 'dark' class is on <html>) */
        .dark .roxy-gradient {
            background-image: linear-gradient(135deg, #370a5c 0%, #4c1d95 100%); /* Deep Indigo/Purple */
            box-shadow: 0 10px 30px rgba(55, 10, 92, 0.7);
        }

        /* Glowing Text Effect for the main title */
        .glow-text {
            text-shadow: 0 0 12px rgba(255, 255, 255, 0.6);
        }
        
        /* Utility class for icon font size */
        .weather-icon-lg {
            font-size: 7rem; /* 112px */
            line-height: 1;
        }

    </style>
    <script>
        // Tailwind configuration for custom colors (Enhanced MD3 inspired)
        tailwind.config = {
            darkMode: 'class', // Enable dark mode based on 'dark' class
            theme: {
                extend: {
                    colors: {
                        // Custom Palette based on Roxy's theme
                        'roxy-purple': '#a78bfa',
                        
                        // Light Mode Colors
                        'surface-light': '#ffffff',
                        'card-light': '#f7f9fb', /* Lighter background for cards */
                        'text-light': '#1f2937',

                        // Dark Mode Colors (Deep, magical theme)
                        'surface-dark': '#0f172a', /* Very dark blue */
                        'card-dark': '#1e293b',   /* Slightly lighter surface */
                        'text-dark': '#f1f5f9',
                    },
                    boxShadow: {
                        'md3-sm': '0 2px 4px rgba(0, 0, 0, 0.05)',
                        'md3-lg': '0 10px 20px rgba(0, 0, 0, 0.1)',
                        'roxy-hover': '0 15px 30px rgba(167, 139, 250, 0.35)',
                    }
                }
            }
        }
    </script>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4 sm:p-8 bg-gray-100 dark:bg-surface-dark transition-colors duration-500">

    <!-- Main Container Card -->
    <div class="w-full max-w-5xl bg-surface-light dark:bg-surface-dark rounded-3xl shadow-2xl overflow-hidden transition-all duration-500">
        
        <!-- Header: Roxy Theme -->
        <div class="roxy-gradient text-white p-6 sm:p-8 flex items-center justify-between rounded-t-3xl">
            <div class="flex-grow">
                <h1 class="text-3xl sm:text-4xl font-extrabold tracking-tight glow-text mb-1">
                    æ´›çªå¸Œçš„<span id="location-display">æŸ³å·</span>é­”æ³•æ°”è±¡ç«™
                </h1>
                <p class="text-sm sm:text-lg opacity-90 font-light mt-1">
                    â€œæ„¿æ‚¨ä»Šå¤©çš„æ—…é€”ï¼Œä¸å—é£é›¨å›°æ‰°ã€‚â€
                </p>
            </div>
            
            <!-- Dark Mode Toggle and Icon -->
            <div class="flex items-center space-x-4 ml-4">
                <button id="theme-toggle" class="p-2 rounded-full hover:bg-white/20 transition-colors duration-300" title="åˆ‡æ¢ä¸»é¢˜">
                    <!-- Sun Icon (Light Mode) -->
                    <svg id="sun-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 dark:hidden">
                        <path d="M12 2.25a.75.75 0 0 1 .75.75v2.25a.75.75 0 0 1-1.5 0V3a.75.75 0 0 1 .75-.75ZM7.584 6.224a.75.75 0 0 0-1.06 1.06l1.59 1.59a.75.75 0 0 0 1.06-1.06l-1.59-1.59ZM16.5 4.5a.75.75 0 0 0-.75.75v2.25a.75.75 0 0 0 1.5 0V5.25a.75.75 0 0 0-.75-.75ZM4.5 12a.75.75 0 0 0 .75.75h2.25a.75.75 0 0 0 0-1.5H5.25A.75.75 0 0 0 4.5 12ZM16.5 12a.75.75 0 0 0 .75.75h2.25a.75.75 0 0 0 0-1.5h-2.25a.75.75 0 0 0-.75.75ZM7.584 17.776a.75.75 0 0 0 1.06-1.06l-1.59-1.59a.75.75 0 1 0-1.06 1.06l1.59 1.59ZM18.416 17.776a.75.75 0 0 0 1.06-1.06l-1.59-1.59a.75.75 0 1 0-1.06 1.06l1.59 1.59ZM12 15a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z" />
                    </svg>
                    <!-- Moon Icon (Dark Mode) -->
                    <svg id="moon-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 hidden dark:block">
                        <path fill-rule="evenodd" d="M9.52 2.36l1.378 1.488A16.126 16.126 0 0 1 12 2.25c2.404 0 4.708.577 6.765 1.628l1.378-1.488c.325-.35.845-.35 1.17 0a.75.75 0 0 1 0 1.051l-3.275 3.535a.75.75 0 0 1-1.257-.14l-.364-1.722A14.613 14.613 0 0 0 12 5.25c-2.222 0-4.385.441-6.398 1.258L5.237 8.337a.75.75 0 0 1-1.257.14L.705 4.411a.75.75 0 0 1 0-1.051c.325-.35.845-.35 1.17 0l1.378 1.488A16.127 16.127 0 0 1 5.923 2.36l1.378 1.488A16.126 16.126 0 0 1 9.52 2.36Zm.398 19.34a16.126 16.126 0 0 1-1.378-1.488l-1.378 1.488a.75.75 0 0 1-1.17 0 .75.75 0 0 1 0-1.051l3.275-3.535a.75.75 0 0 1 1.257.14l.364 1.722A14.613 14.613 0 0 0 12 18.75c2.222 0 4.385-.441 6.398-1.258l.364-1.722a.75.75 0 0 1 1.257-.14l3.275 3.535a.75.75 0 0 1 0 1.051.75.75 0 0 1-1.17 0l-1.378-1.488a16.126 16.126 0 0 1-1.378 1.488.75.75 0 0 1-1.17 0l-1.378-1.488a16.126 16.126 0 0 1-1.378 1.488l-1.378 1.488a.75.75 0 0 1-1.17 0Z" clip-rule="evenodd" />
                    </svg>
                </button>

                 <!-- Roxy Magic Icon -->
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-12 h-12 text-white opacity-90 transition-transform duration-500 hover:rotate-12 hidden sm:block">
                    <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25ZM12.75 6a.75.75 0 0 0-1.5 0v6.75a.75.75 0 0 0 1.5 0V6ZM15 9.75a.75.75 0 0 0 0 1.5h-.75a.75.75 0 0 0 0-1.5H15ZM10.5 9.75a.75.75 0 0 0 0 1.5h.75a.75.75 0 0 0 0-1.5h-.75ZM12 14.25a.75.75 0 0 1 .75.75v.75a.75.75 0 0 1-1.5 0v-.75a.75.75 0 0 1 .75-.75ZM16.5 12a.75.75 0 0 0 0-1.5h-.75a.75.75 0 0 0 0 1.5h.75ZM7.5 12a.75.75 0 0 0 0-1.5h.75a.75.75 0 0 0 0 1.5h-.75Z" clip-rule="evenodd" />
                    <path fill-rule="evenodd" d="M12 22.5c5.076 0 9.2-4.041 9.746-9.155a.75.75 0 1 0-1.485-.357A8.252 8.252 0 0 1 12 21c-4.556 0-8.25-3.694-8.25-8.25 0-4.073 2.935-7.464 6.819-8.083a.75.75 0 1 0-.158-1.496C5.698 3.794 2.25 7.568 2.25 12c0 5.385 4.365 9.75 9.75 9.75Z" clip-rule="evenodd" />
                </svg>
            </div>
        </div>

        <!-- Status Area (Loading/Error) -->
        <div id="status-area" class="p-8 text-center text-text-light dark:text-text-dark min-h-32 flex flex-col justify-center transition-colors duration-500">
            <div id="loading-spinner" class="flex flex-col items-center">
                <div class="animate-spin rounded-full h-12 w-12 border-4 border-roxy-purple dark:border-roxy-purple border-t-transparent mx-auto mb-4"></div>
                <p class="text-lg">æ­£åœ¨å‘é­”ç•Œå‘é€å¤©æ°”è¯·æ±‚...</p>
            </div>
            
            <div id="error-message" class="text-red-600 bg-red-100 dark:bg-red-900 dark:text-red-300 p-4 rounded-lg hidden">
                <p class="font-semibold text-xl">âœ¨ é­”æ³•å¤±è´¥ âœ¨</p>
                <p class="text-sm mt-2" id="error-text">æ— æ³•è·å–å¤©æ°”æ•°æ®ã€‚è¯·æ£€æŸ¥ç½‘ç»œæˆ–é­”æ³•æºã€‚</p>
            </div>
        </div>

        <!-- Weather Content Cards -->
        <div id="weather-content" class="p-4 sm:p-8 space-y-10 hidden text-text-light dark:text-text-dark">
            
            <!-- CURRENT WEATHER SECTION (Main Focus) -->
            <section>
                <h2 class="text-2xl font-bold mb-6 border-b border-roxy-purple/50 pb-2">å½“å‰é­”åŠ›æ³¢åŠ¨</h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    
                    <!-- 1. Main Temperature Card (Central Element) -->
                    <div class="lg:col-span-1 bg-card-light dark:bg-card-dark p-8 rounded-2xl shadow-md3-lg flex flex-col items-center justify-center transition-colors duration-500">
                        <h2 id="weather-icon" class="weather-icon-lg text-roxy-purple dark:text-roxy-purple transition-transform duration-500 hover:scale-105">---</h2> 
                        <div class="text-center mt-4">
                            <span id="temp" class="text-7xl font-extrabold">--Â°C</span>
                            <p id="description" class="text-xl font-semibold text-gray-700 dark:text-gray-300 mt-2">å½“å‰å¤©æ°”çŠ¶å†µ</p>
                            <p id="temp-range" class="text-md text-gray-500 dark:text-gray-400 mt-1">ä»Šæ—¥ï¼š--Â°C / --Â°C</p>
                        </div>
                    </div>

                    <!-- 2. Detail Metrics Grid (Side Element, 2x2 Layout) -->
                    <div class="lg:col-span-2 grid grid-cols-2 md:grid-cols-4 gap-4">
                        
                        <!-- Metric Card Template -->
                        <div class="bg-card-light dark:bg-card-dark p-4 rounded-xl shadow-md3-sm flex flex-col items-center justify-center transition-all duration-300 hover:shadow-roxy-hover hover:scale-[1.03] cursor-default">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 text-roxy-purple mb-1">
                                <path fill-rule="evenodd" d="M18.685 19.066A2.25 2.25 0 0 1 12 22.5c-3.275 0-6.241-1.28-8.406-3.351A1.875 1.875 0 0 1 3.75 16.5v-1.125c.047-.134.1-.266.15-.395.239-.672.663-1.27.795-1.393L9.75 6.45 10.5 7.2l-3.25 5.514A2.695 2.695 0 0 0 6.185 14.5c-.32.007-.639.007-.958.007v.993c0 .265.111.517.306.703 1.258 1.159 3.125 1.94 5.167 1.94 2.112 0 4.026-.81 5.312-2.096.188-.188.307-.442.307-.707v-.993c-.32.007-.639.007-.958.007A2.695 2.695 0 0 0 14.25 13.5l5.064-5.064A.75.75 0 0 1 20.25 9v5.25c0 .24-.136.463-.357.578a2.25 2.25 0 0 1-1.208 1.988Z" clip-rule="evenodd" />
                                <path fill-rule="evenodd" d="M12 2.25a.75.75 0 0 1 .75.75v5.25a.75.75 0 0 1-1.5 0V3a.75.75 0 0 1 .75-.75Z" clip-rule="evenodd" />
                            </svg>
                            <p class="text-sm text-gray-600 dark:text-gray-400">ä½“æ„Ÿæ¸©åº¦</p>
                            <p id="apparent-temp" class="text-xl font-bold mt-1">--Â°C</p>
                        </div>

                        <div class="bg-card-light dark:bg-card-dark p-4 rounded-xl shadow-md3-sm flex flex-col items-center justify-center transition-all duration-300 hover:shadow-roxy-hover hover:scale-[1.03] cursor-default">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 text-roxy-purple mb-1">
                                <path fill-rule="evenodd" d="M12 2.25a6.75 6.75 0 0 0-6.75 6.75c0 3.784-1.5 6.425-3.084 7.641A4.5 4.5 0 0 0 5.625 22.5h12.75a4.5 4.5 0 0 0 3.084-1.859c-1.584-1.216-3.084-3.857-3.084-7.641A6.75 6.75 0 0 0 12 2.25Z" clip-rule="evenodd" />
                            </svg>
                            <p class="text-sm text-gray-600 dark:text-gray-400">ç›¸å¯¹æ¹¿åº¦</p>
                            <p id="humidity" class="text-xl font-bold mt-1">-- %</p>
                        </div>
                        
                        <!-- Wind Speed and Direction (Optimized Layout) -->
                        <div class="bg-card-light dark:bg-card-dark p-4 rounded-xl shadow-md3-sm flex flex-col items-center justify-center transition-all duration-300 hover:shadow-roxy-hover hover:scale-[1.03] cursor-default">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 text-roxy-purple mb-1">
                                <path d="M11.5 2.75a.75.75 0 0 1 .75.75v5.437l.794-.794a.75.75 0 1 1 1.06 1.06L12.56 12.31l-3.375-3.375a.75.75 0 1 1 1.06-1.06l.794.793V3.5a.75.75 0 0 1 .75-.75Z" />
                                <path d="M4.5 13.5a.75.75 0 0 0-.75.75v5.25c0 .414.336.75.75.75h15c.414 0 .75-.336.75-.75v-5.25a.75.75 0 0 0-1.5 0v5.25h-13.5v-5.25a.75.75 0 0 0-.75-.75Z" />
                            </svg>
                            <p class="text-sm text-gray-600 dark:text-gray-400">é£é€Ÿ / é£å‘</p>
                            <div class="flex flex-col items-center mt-1">
                                <p id="wind-speed" class="text-xl font-bold">-- km/h</p>
                                <p id="wind-direction" class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">--</p>
                            </div>
                        </div>
                        
                        <div class="bg-card-light dark:bg-card-dark p-4 rounded-xl shadow-md3-sm flex flex-col items-center justify-center transition-all duration-300 hover:shadow-roxy-hover hover:scale-[1.03] cursor-default">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-6 h-6 text-roxy-purple mb-1">
                                <path fill-rule="evenodd" d="M12 2.25c-5.385 0-9.75 4.365-9.75 9.75s4.365 9.75 9.75 9.75 9.75-4.365 9.75-9.75S17.385 2.25 12 2.25Zm4.28 10.28a.75.75 0 0 0 0-1.06l-3.5-3.5a.75.75 0 0 0-1.06 0l-3.5 3.5a.75.75 0 0 0 1.06 1.06l2.97-2.97v6.44a.75.75 0 0 0 1.5 0v-6.44l2.97 2.97Z" clip-rule="evenodd" />
                            </svg>
                            <p class="text-sm text-gray-600 dark:text-gray-400">æ°”å‹</p>
                            <p id="pressure" class="text-xl font-bold mt-1">-- hPa</p>
                        </div>

                    </div>
                </div>
            </section>


            <!-- 7-DAY FORECAST SECTION -->
            <section>
                <h2 class="text-2xl font-bold mb-6 border-b border-roxy-purple/50 pb-2">æœªæ¥ä¸ƒæ—¥é¢„æŠ¥ (é­”æ³•è½¨è¿¹)</h2>
                <div id="daily-forecast-container" class="grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-7 gap-3 sm:gap-4">
                    <!-- Daily Forecast Cards will be injected here by JavaScript -->
                </div>
            </section>
            
            <p class="text-sm text-center text-gray-400 dark:text-gray-500 pt-4 transition-colors duration-500">
                æ•°æ®æ›´æ–°äº: <span id="update-time">--</span> | WMOç : <span id="weather-code">--</span>
            </p>

        </div>

        <div id="footer-note" class="p-4 text-xs text-center text-gray-500 dark:text-gray-400 border-t border-gray-200 dark:border-gray-800 rounded-b-3xl transition-colors duration-500">
            æ•°æ®æ¥æº: Open-Meteo.com (å…è´¹å¼€æ”¾ APIï¼Œæ— éœ€å¯†é’¥)
        </div>

    </div>

    <!-- JavaScript for Theme and Weather Data -->
    <script>
        // --- Configuration ---
        const LATITUDE = 24.33; // æŸ³å·å¤§è‡´çº¬åº¦
        const LONGITUDE = 109.41; // æŸ³å·å¤§è‡´ç»åº¦
        // V5 ä¼˜åŒ–: å¢åŠ  wind_direction_10m
        const API_URL = `https://api.open-meteo.com/v1/forecast?latitude=${LATITUDE}&longitude=${LONGITUDE}&current=temperature_2m,apparent_temperature,weather_code,surface_pressure,relative_humidity_2m,wind_speed_10m,wind_direction_10m&daily=weather_code,temperature_2m_max,temperature_2m_min,precipitation_sum,precipitation_probability_max&timezone=Asia%2FSingapore&forecast_days=7`;

        // --- DOM Elements ---
        const htmlEl = document.documentElement;
        const themeToggleBtn = document.getElementById('theme-toggle');
        const locationDisplay = document.getElementById('location-display');
        const statusArea = document.getElementById('status-area');
        const loadingSpinner = document.getElementById('loading-spinner');
        const errorMessageDiv = document.getElementById('error-message');
        const errorTextEl = document.getElementById('error-text');
        const weatherContentDiv = document.getElementById('weather-content');
        
        // Current Weather Elements
        const descriptionEl = document.getElementById('description');
        const tempEl = document.getElementById('temp');
        const weatherCodeEl = document.getElementById('weather-code');
        const tempRangeEl = document.getElementById('temp-range');
        const windSpeedEl = document.getElementById('wind-speed');
        const windDirectionEl = document.getElementById('wind-direction'); // æ–°å¢é£å‘å…ƒç´ 
        const humidityEl = document.getElementById('humidity');
        const pressureEl = document.getElementById('pressure');
        const apparentTempEl = document.getElementById('apparent-temp');
        const updateTimeEl = document.getElementById('update-time');
        const weatherIconEl = document.getElementById('weather-icon');
        const dailyForecastContainer = document.getElementById('daily-forecast-container');


        // --- 1. Dark Mode Logic ---

        function loadTheme() {
            const storedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

            if (storedTheme === 'dark' || (!storedTheme && prefersDark)) {
                htmlEl.classList.add('dark');
            } else {
                htmlEl.classList.remove('dark');
            }
        }

        function toggleTheme() {
            if (htmlEl.classList.contains('dark')) {
                htmlEl.classList.remove('dark');
                localStorage.setItem('theme', 'light');
            } else {
                htmlEl.classList.add('dark');
                localStorage.setItem('theme', 'dark');
            }
        }

        themeToggleBtn.addEventListener('click', toggleTheme);
        

        // --- 2. Weather Data Mapping ---

        /**
         * WMO Weather Interpretation Codes (WMO CODE) to Chinese description and Emoji.
         */
        function getWeatherWmoInfo(code) {
            // Simplified WMO codes for general display
            if (code <= 3) return { description: code === 0 ? 'æ™´æœ— (æ´›çªå¸Œçš„ç¥ç¦)' : 'å¤šäº‘/é˜´å¤©', emoji: code === 0 ? 'â˜€ï¸' : (code <= 1 ? 'ğŸŒ¤ï¸' : 'â˜ï¸') };
            if (code >= 45 && code <= 48) return { description: 'è¿·é›¾ (ç©ºé—´è½¬ç§»ä¸­)', emoji: 'ğŸŒ«ï¸' };
            if (code >= 51 && code <= 65) return { description: 'é™é›¨ (æ°´é­”æœ¯)', emoji: code <= 55 ? 'ğŸŒ§ï¸' : 'â˜”' };
            if (code >= 71 && code <= 77) return { description: 'é™é›ª (å†°é­”æœ¯)', emoji: 'â„ï¸' };
            if (code >= 80 && code <= 82) return { description: 'é˜µé›¨/å¼ºé˜µé›¨', emoji: 'ğŸŒ¦ï¸' };
            if (code >= 95 && code <= 99) return { description: 'é›·æš´ (é—ªç”µé­”æœ¯)', emoji: 'âš¡' };
            return { description: 'æœªçŸ¥é­”æ³•æ³¢åŠ¨', emoji: 'â“' };
        }
        
        /**
         * Converts wind direction degrees (0-360) to Chinese cardinal direction.
         */
        function getWindDirectionText(degrees) {
            const directions = ["åŒ—é£", "ä¸œåŒ—é£", "ä¸œé£", "ä¸œå—é£", "å—é£", "è¥¿å—é£", "è¥¿é£", "è¥¿åŒ—é£"];
            // Add 22.5 to shift the starting point so 0-22.5 is North
            const index = Math.round((degrees % 360) / 45);
            return directions[index % 8];
        }

        /**
         * Renders the 7-day daily forecast cards.
         */
        function renderDailyForecast(daily) {
            dailyForecastContainer.innerHTML = ''; // Clear previous content
            
            const daysOfWeek = ['å‘¨æ—¥', 'å‘¨ä¸€', 'å‘¨äºŒ', 'å‘¨ä¸‰', 'å‘¨å››', 'å‘¨äº”', 'å‘¨å…­'];
            
            for (let i = 0; i < daily.time.length; i++) {
                const dateStr = daily.time[i];
                const date = new Date(dateStr);
                const dayIndex = date.getDay();
                
                const isToday = i === 0;
                const dayName = isToday ? 'ä»Šå¤©' : daysOfWeek[dayIndex];
                
                const minTemp = Math.round(daily.temperature_2m_min[i]);
                const maxTemp = Math.round(daily.temperature_2m_max[i]);
                const wmoCode = daily.weather_code[i];
                const precipProb = daily.precipitation_probability_max[i];
                
                const info = getWeatherWmoInfo(wmoCode);

                const cardHtml = `
                    <div class="bg-card-light dark:bg-card-dark p-3 rounded-xl shadow-md3-sm flex flex-col items-center justify-between min-h-36 
                                transition-all duration-300 hover:shadow-roxy-hover hover:scale-[1.03] cursor-pointer text-center
                                ${isToday ? 'border-2 border-roxy-purple dark:border-roxy-purple/70' : 'border border-transparent'}">
                        
                        <p class="font-semibold text-base mb-1 ${isToday ? 'text-roxy-purple dark:text-roxy-purple' : 'text-gray-700 dark:text-gray-300'}">${dayName}</p>

                        <span class="text-3xl mb-1">${info.emoji}</span>
                        
                        <p class="text-xs font-medium text-gray-600 dark:text-gray-400 mb-1">${info.description.split(' ')[0]}</p>

                        <p class="text-base font-bold">${maxTemp}Â° / ${minTemp}Â°</p>
                        
                        <div class="flex items-center text-xs text-blue-600 dark:text-blue-400 mt-1">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-3 h-3 mr-0.5">
                                <path d="M11.72 1.52a.75.75 0 0 1 1.06 0l7.5 7.5c.24.24.375.56.375.901v9.799a2.25 2.25 0 0 1-2.25 2.25H4.5A2.25 2.25 0 0 1 2.25 19.799v-9.799c0-.34.135-.66.375-.901l7.5-7.5Z" clip-rule="evenodd" />
                            </svg>
                            ${precipProb}%
                        </div>
                    </div>
                `;
                dailyForecastContainer.innerHTML += cardHtml;
            }
        }

        /**
         * Displays an error message and hides the content.
         */
        function showError(message) {
            console.error("Weather Fetch Error:", message);
            loadingSpinner.style.display = 'none';
            weatherContentDiv.classList.add('hidden');
            errorMessageDiv.classList.remove('hidden');
            statusArea.classList.remove('justify-center');
            errorTextEl.textContent = message;
        }

        /**
         * Fetches weather data from Open-Meteo API.
         */
        async function fetchWeather() {
            loadingSpinner.style.display = 'flex';
            errorMessageDiv.classList.add('hidden');
            weatherContentDiv.classList.add('hidden');
            statusArea.classList.add('justify-center');
            
            try {
                const response = await fetch(API_URL);
                if (!response.ok) {
                    throw new Error(`HTTP Error: ${response.status}`);
                }

                const data = await response.json();
                
                if (!data.current || !data.daily || !data.daily.time || data.daily.time.length === 0) {
                    throw new Error("APIè¿”å›æ•°æ®æ ¼å¼ä¸æ­£ç¡®ã€‚");
                }
                
                const current = data.current;
                const daily = data.daily;

                // --- 1. Current Weather Update ---
                const weatherInfo = getWeatherWmoInfo(current.weather_code);
                const minTemp = Math.round(daily.temperature_2m_min[0]);
                const maxTemp = Math.round(daily.temperature_2m_max[0]);
                
                tempEl.textContent = `${Math.round(current.temperature_2m)}Â°C`;
                descriptionEl.textContent = weatherInfo.description;
                weatherIconEl.textContent = weatherInfo.emoji; 
                tempRangeEl.textContent = `ä»Šæ—¥ï¼š${maxTemp}Â°C / ${minTemp}Â°C`;
                
                // Detail Info
                windSpeedEl.textContent = `${current.wind_speed_10m.toFixed(1)} km/h`;
                // V5 ä¼˜åŒ–: æ–°å¢é£å‘æ˜¾ç¤º
                windDirectionEl.textContent = getWindDirectionText(current.wind_direction_10m); 

                humidityEl.textContent = `${current.relative_humidity_2m} %`;
                pressureEl.textContent = `${current.surface_pressure.toFixed(0)} hPa`; 
                apparentTempEl.textContent = `${Math.round(current.apparent_temperature)}Â°C`; 
                weatherCodeEl.textContent = `${current.weather_code}`;
                
                // Update Time
                const date = new Date(current.time);
                updateTimeEl.textContent = date.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit', second: '2-digit', timeZoneName: 'short' });

                // --- 2. Daily Forecast Update ---
                renderDailyForecast(daily);

                // Show Content
                loadingSpinner.style.display = 'none';
                weatherContentDiv.classList.remove('hidden');
                statusArea.classList.remove('justify-center');

            } catch (error) {
                locationDisplay.textContent = 'é”™è¯¯';
                showError(error.message || 'ç½‘ç»œè¿æ¥å¤±è´¥');
            }
        }

        // Initialize on load
        window.onload = function() {
            loadTheme(); // Load theme preference first
            fetchWeather();
        };

    </script>
</body>
</html>
